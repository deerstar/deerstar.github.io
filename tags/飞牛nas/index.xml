<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>飞牛NAS on DeerStar的博客</title><link>https://deerstar.xyz/tags/%E9%A3%9E%E7%89%9Bnas/</link><description>Recent content in 飞牛NAS on DeerStar的博客</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 24 Dec 2025 14:00:00 +0800</lastBuildDate><atom:link href="https://deerstar.xyz/tags/%E9%A3%9E%E7%89%9Bnas/index.xml" rel="self" type="application/rss+xml"/><item><title>PVE安装飞牛NAS：SATA直通与网卡配置实战</title><link>https://deerstar.xyz/2025/pve-install-fnos/</link><pubDate>Wed, 24 Dec 2025 14:00:00 +0800</pubDate><guid>https://deerstar.xyz/2025/pve-install-fnos/</guid><description>&lt;h1 id="pve安装飞牛nassata直通与网卡配置实战"&gt;PVE安装飞牛NAS：SATA直通与网卡配置实战
&lt;/h1&gt;
&lt;h2 id="前情提要"&gt;前情提要
&lt;/h2&gt;
&lt;p&gt;上篇搞定了PVE安装和IOMMU配置,这篇记录飞牛OS虚拟机的创建过程。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;核心要点&lt;/strong&gt;：飞牛OS必须用SATA接口,这是个大坑。&lt;/p&gt;
&lt;h2 id="硬件直通规划"&gt;硬件直通规划
&lt;/h2&gt;
&lt;p&gt;我的方案：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;板载Intel网口&lt;/strong&gt; → 直通给飞牛（千兆高性能）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PCIE网卡&lt;/strong&gt; → PVE宿主机管理用&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;2T机械盘&lt;/strong&gt; → 直通给飞牛（数据盘）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;核显&lt;/strong&gt; → PVE宿主机显示&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;x16槽留给FPGA板卡。&lt;/p&gt;
&lt;h2 id="一网卡切换准备"&gt;一、网卡切换准备
&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;问题&lt;/strong&gt;：只有一个板载网口,直通给飞牛后PVE就没网了。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决&lt;/strong&gt;：加一块PCIE千兆网卡（闲置硬件利用）。&lt;/p&gt;
&lt;h3 id="1-安装pcie网卡"&gt;1. 安装PCIE网卡
&lt;/h3&gt;
&lt;p&gt;关机,把PCIE网卡插到x1槽（别插x16）,网线从板载网口拔出插到PCIE网卡,开机。&lt;/p&gt;
&lt;h3 id="2-切换pve网络配置"&gt;2. 切换PVE网络配置
&lt;/h3&gt;
&lt;p&gt;接显示器+键盘登录PVE本地控制台：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 查看网卡名称&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ip a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;能看到新网卡（我的是enp2s0）。&lt;/p&gt;
&lt;p&gt;备份并修改网络配置：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;cp /etc/network/interfaces /etc/network/interfaces.bak
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;nano /etc/network/interfaces
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;找到 &lt;code&gt;bridge-ports&lt;/code&gt; 那行,改成新网卡名：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;auto vmbr0
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;iface vmbr0 inet static
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; address 192.168.1.100/24
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; gateway 192.168.1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; bridge-ports enp2s0 # 改这里
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; bridge-stp off
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; bridge-fd 0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;重启网络：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;systemctl restart networking
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 或直接重启&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;reboot
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;验证：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ping 192.168.1.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;能ping通后,浏览器访问 &lt;code&gt;https://192.168.1.100:8006&lt;/code&gt; 确认恢复。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;目的&lt;/strong&gt;：PVE用PCIE网卡,板载Intel网卡留给飞牛直通。&lt;/p&gt;
&lt;h2 id="二上传飞牛os镜像"&gt;二、上传飞牛OS镜像
&lt;/h2&gt;
&lt;p&gt;PVE Web界面：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;点左侧 &lt;code&gt;local&lt;/code&gt; 存储&lt;/li&gt;
&lt;li&gt;点 &lt;code&gt;ISO镜像&lt;/code&gt; → &lt;code&gt;上传&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;选择飞牛OS镜像（fnos-1.1.8-1419.iso）&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="三创建虚拟机"&gt;三、创建虚拟机
&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;重点&lt;/strong&gt;：飞牛OS需要SATA接口,不能用SCSI！&lt;/p&gt;
&lt;h3 id="1-基础配置"&gt;1. 基础配置
&lt;/h3&gt;
&lt;p&gt;点右上角 &lt;strong&gt;Create VM&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;常规&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VM ID: 100&lt;/li&gt;
&lt;li&gt;名称: MFNAS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;操作系统&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ISO镜像：选飞牛OS镜像&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;系统&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;机器类型：q35&lt;/li&gt;
&lt;li&gt;BIOS：SeaBIOS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;磁盘&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;删除默认磁盘&lt;/strong&gt;（点删除按钮）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;为什么删除？因为默认是SCSI接口,飞牛OS不认。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CPU&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;核心数：4&lt;/li&gt;
&lt;li&gt;类型：host&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;内存&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;大小：8192 MB（8G）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;网络&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;默认配置&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;确认&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;不要勾选&lt;/strong&gt;&amp;ldquo;创建后启动&amp;rdquo;&lt;/li&gt;
&lt;li&gt;点&amp;quot;完成&amp;quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="2-手动添加sata系统盘"&gt;2. 手动添加SATA系统盘
&lt;/h3&gt;
&lt;p&gt;虚拟机创建完成后：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;选中虚拟机100 → 硬件 → 添加 → 硬盘&lt;/li&gt;
&lt;li&gt;配置：
&lt;ul&gt;
&lt;li&gt;总线/设备：&lt;strong&gt;SATA 0&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;磁盘大小：64 GiB&lt;/li&gt;
&lt;li&gt;存储：local-lvm&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;点&amp;quot;添加&amp;quot;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="四配置硬件直通"&gt;四、配置硬件直通
&lt;/h2&gt;
&lt;h3 id="1-板载网卡直通"&gt;1. 板载网卡直通
&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;方法一：命令行（推荐）&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;qm &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="m"&gt;100&lt;/span&gt; -hostpci0 0000:00:1f.6,rombar&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;方法二：Web界面&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;虚拟机100 → 硬件 → 添加 → PCI设备&lt;/li&gt;
&lt;li&gt;设备：选择 &lt;code&gt;00:1f.6 (Intel I219-V)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;不要勾选&amp;quot;Primary GPU&amp;quot;&lt;/li&gt;
&lt;li&gt;点&amp;quot;添加&amp;quot;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;：如果Web界面添加后地址不完整（缺少&lt;code&gt;.6&lt;/code&gt;）,需手动修改配置文件。&lt;/p&gt;
&lt;h3 id="2-2t机械盘直通"&gt;2. 2T机械盘直通
&lt;/h3&gt;
&lt;p&gt;查看硬盘ID：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ls -l /dev/disk/by-id/ &lt;span class="p"&gt;|&lt;/span&gt; grep sda
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;直通硬盘（&lt;strong&gt;用SATA接口&lt;/strong&gt;）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;qm &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="m"&gt;100&lt;/span&gt; -sata1 /dev/disk/by-id/ata-ST2000DM006-2DM164_Z4ZAHREX
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;重点&lt;/strong&gt;：用 &lt;code&gt;-sata1&lt;/code&gt; 而不是 &lt;code&gt;-scsi1&lt;/code&gt;,因为飞牛OS需要SATA接口。&lt;/p&gt;
&lt;h3 id="3-验证配置"&gt;3. 验证配置
&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;cat /etc/pve/qemu-server/100.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;检查配置应包含：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;span class="lnt"&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;bios: seabios
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;boot: order=sata0
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;cores: 4
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;cpu: host
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hostpci0: 0000:00:1f.6,rombar=0 # 板载网卡
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;machine: q35
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;memory: 8192
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sata0: local-lvm:vm-100-disk-0,size=64G # 系统盘
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sata1: /dev/disk/by-id/ata-ST2000DM006-2DM164_Z4ZAHREX,size=1953514584K # 数据盘
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;关键确认&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✅ 机器类型：q35&lt;/li&gt;
&lt;li&gt;✅ BIOS：SeaBIOS&lt;/li&gt;
&lt;li&gt;✅ 网卡地址完整：&lt;code&gt;0000:00:1f.6&lt;/code&gt;（包含&lt;code&gt;.6&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;✅ 磁盘都是SATA接口&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="五安装飞牛os系统"&gt;五、安装飞牛OS系统
&lt;/h2&gt;
&lt;h3 id="1-启动虚拟机"&gt;1. 启动虚拟机
&lt;/h3&gt;
&lt;p&gt;Web界面：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;选中虚拟机100&lt;/li&gt;
&lt;li&gt;点&amp;quot;启动&amp;quot;&lt;/li&gt;
&lt;li&gt;点&amp;quot;控制台&amp;quot;查看启动过程&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="2-安装系统"&gt;2. 安装系统
&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;进入安装界面,选&amp;quot;图形化安装&amp;quot;&lt;/li&gt;
&lt;li&gt;选择安装位置：选64G的SATA磁盘
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;不要选2T机械盘&lt;/strong&gt;（数据盘留待进系统后配置）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;分区大小：默认64G&lt;/li&gt;
&lt;li&gt;等待安装完成&lt;/li&gt;
&lt;li&gt;自动重启&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="3-初始化配置"&gt;3. 初始化配置
&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;重启后控制台显示访问地址：&lt;code&gt;http://192.168.1.x:5666&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;浏览器访问该地址&lt;/li&gt;
&lt;li&gt;设置管理员账号密码&lt;/li&gt;
&lt;li&gt;同意协议,进入系统&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="六系统配置"&gt;六、系统配置
&lt;/h2&gt;
&lt;h3 id="1-网络配置可选"&gt;1. 网络配置（可选）
&lt;/h3&gt;
&lt;p&gt;系统默认DHCP获取IP,建议改成静态：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;系统设置 → 网络设置&lt;/li&gt;
&lt;li&gt;能看到两个网口：
&lt;ul&gt;
&lt;li&gt;网口1：VirtIO虚拟网卡&lt;/li&gt;
&lt;li&gt;网口2：板载Intel网卡（直通）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;建议禁用虚拟网卡,只用物理网卡&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;删除虚拟网卡方法&lt;/strong&gt;（可选）：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 关闭虚拟机后&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;nano /etc/pve/qemu-server/100.conf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 删除这一行&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;net0: &lt;span class="nv"&gt;virtio&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;...,bridge&lt;span class="o"&gt;=&lt;/span&gt;vmbr0,firewall&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 修改启动顺序,去掉net0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;boot: &lt;span class="nv"&gt;order&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;sata0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="2-添加存储池"&gt;2. 添加存储池
&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;进入&amp;quot;存储空间管理&amp;quot;&lt;/li&gt;
&lt;li&gt;点&amp;quot;立即创建&amp;quot;&lt;/li&gt;
&lt;li&gt;选择2T机械盘（直通的硬盘）&lt;/li&gt;
&lt;li&gt;选择存储模式（单盘/RAID等）&lt;/li&gt;
&lt;li&gt;确认创建&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="3-验证硬件直通"&gt;3. 验证硬件直通
&lt;/h3&gt;
&lt;p&gt;SSH连接飞牛OS：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 查看网卡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ip a
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 查看硬盘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;lsblk
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 查看直通硬盘SMART信息&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;smartctl -a /dev/sdb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="常见问题"&gt;常见问题
&lt;/h2&gt;
&lt;h3 id="1-虚拟机启动卡在pxe网络启动"&gt;1. 虚拟机启动卡在PXE网络启动
&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原因&lt;/strong&gt;：磁盘接口类型错误或启动顺序问题&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决&lt;/strong&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;确认用SATA接口而不是SCSI&lt;/li&gt;
&lt;li&gt;检查启动顺序（光驱优先或SATA硬盘优先）&lt;/li&gt;
&lt;li&gt;删除网卡直通后再尝试（先装系统,后加直通）&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="2-安装时提示secure-boot错误"&gt;2. 安装时提示&amp;quot;Secure Boot&amp;quot;错误
&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原因&lt;/strong&gt;：使用了UEFI BIOS且启用了Secure Boot&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用SeaBIOS而不是OVMF（UEFI）&lt;/li&gt;
&lt;li&gt;删除EFI磁盘,改BIOS类型为SeaBIOS&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="3-网卡直通地址不完整"&gt;3. 网卡直通地址不完整
&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;现象&lt;/strong&gt;：配置文件中 &lt;code&gt;hostpci0: 0000:00:1f&lt;/code&gt; 缺少 &lt;code&gt;.6&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决&lt;/strong&gt;：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;nano /etc/pve/qemu-server/100.conf
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 手动补全为 0000:00:1f.6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="4-pve宿主机切换网卡后无法访问"&gt;4. PVE宿主机切换网卡后无法访问
&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;原因&lt;/strong&gt;：网络配置文件未更新&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;接显示器键盘本地登录&lt;/li&gt;
&lt;li&gt;修改 &lt;code&gt;/etc/network/interfaces&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;将 &lt;code&gt;bridge-ports&lt;/code&gt; 改为新网卡名&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="网络架构对比"&gt;网络架构对比
&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;方案A：飞牛直通板载网口（我的方案）&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;优势：路由器↔飞牛传输速度稳定（千兆满速）&lt;/li&gt;
&lt;li&gt;劣势：Win10↔飞牛传输受千兆限制（50-80 MB/s）&lt;/li&gt;
&lt;li&gt;适用：主要从外网下载到NAS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;方案B：飞牛用虚拟网卡&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;优势：Win10↔飞牛传输极快（300-500 MB/s,内存直通）&lt;/li&gt;
&lt;li&gt;劣势：需要时再切换&lt;/li&gt;
&lt;li&gt;适用：主要从Win10传输到NAS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我选方案A是因为外网下载用得多。如果你主要是内网互传,建议方案B。&lt;/p&gt;
&lt;h2 id="总结"&gt;总结
&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;关键要点&lt;/strong&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;飞牛OS&lt;strong&gt;必须&lt;/strong&gt;用SATA接口,SCSI不兼容&lt;/li&gt;
&lt;li&gt;机器类型用q35（支持PCIe直通）+ SeaBIOS（兼容性最好）&lt;/li&gt;
&lt;li&gt;网卡地址必须完整：&lt;code&gt;0000:00:1f.6&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;好网卡给高需求的虚拟机,凑合网卡给宿主机&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;当前架构&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PVE宿主机：PCIE网卡 → 路由器&lt;/li&gt;
&lt;li&gt;飞牛NAS：板载网卡直通 + 2T机械盘直通&lt;/li&gt;
&lt;li&gt;x16槽：预留给FPGA板卡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="相关阅读"&gt;相关阅读
&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="#" &gt;《老羊机上手PVE虚拟化：IOMMU直通配置完全指南》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="#" &gt;《PVE安装Win10虚拟机：VirtIO驱动与远程桌面配置》&lt;/a&gt;（待发布）&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;em&gt;记录时间：2025-12-24&lt;/em&gt;&lt;br&gt;
&lt;em&gt;PVE版本：9.1 | 飞牛OS版本：1.1.8-1419&lt;/em&gt;&lt;/p&gt;</description></item></channel></rss>